<!DOCTYPE html>
<html>
<head>
    <title>RDAP Conformance Tool</title>
    <!-- Include Vue.js -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>

</head>
<body class="bg-gray-100 h-screen antialiased leading-none">
  <div id="app" class="container mx-auto px-4 pt-10">
    <h1 class="text-4xl mb-4 text-blue-500">{{ message }}</h1>
    <p class="text-lg mb-8">Welcome to RDAP Conformance</p>
   
    <form @submit.prevent="submitForm" class="mb-8">
        <label for="url" class="block mb-2">URL:</label>
        <input type="text" id="url" v-model="url" class="border p-4 h-12 w-full"> <!-- Adjusted size and padding here -->
        <br>
        <input type="submit" value="Submit" :disabled="isLoading" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mt-6 block">
        <input type="reset" value="Clear"  @click="clearResponse" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded mt-6 block"> <!-- Increased top margin here -->
        <span v-if="isLoading" class="block mt-4">Loading...</span> <!-- Show a loading message when loading -->
    </form>
    <p>
      <pre class="text-xs" style="white-space: pre-wrap; word-wrap: break-word; max-width: 100%;">{{ formattedServerResponse }}</pre>
    </p>
  </div>
</body>

  <script>
      new Vue({
          el: '#app',
          data: {
              message: 'RDAP Conformance Tool',
              url: '',
              serverResponse: '', // Add a new data property to hold the server response
              isLoading: false // Add a new data property to hold the loading state
          },
          computed: {
            formattedServerResponse: function() {
                try {
                    let parsedResponse = JSON.parse(this.serverResponse);
                    if (parsedResponse.data) {
                      console.log('yeah, got it: ' + parsedResponse.data);
                      return parsedResponse.data;
                        // let innerData = JSON.parse(parsedResponse.data);
                        // return innerData.value;
                    }
                    console.log('nope, not got it: ', parsedResponse);
                    return JSON.stringify(parsedResponse, null, 2); // stringify with indentation
                } catch(e) {
                    // If it's not JSON, return as is
                    // console.log('error: ', e);
                    return this.serverResponse;
                }
            }
          },
          methods: {
            clearResponse: function() { 
                this.serverResponse = '';
            },
            submitForm() {
              this.isLoading = true; // Set loading state to true when form is submitted
              // Handle form submission
              fetch('/check', {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/x-www-form-urlencoded',
                  },
                  body: `url=${encodeURIComponent(this.url)}`,
              })
              .then(response => response.json())
              .then(data => {
                  // Handle the response data
                  console.log(data);
                  this.serverResponse = JSON.stringify(data); // Update the serverResponse property with the response data
                  this.isLoading = false; // Set loading state to false when response is received
              })
              .catch(error => {
                  // Handle the error
                  console.error('Error:', error);
                  this.serverResponse = 'Error: ' + error; // Update the serverResponse property with the error
                  this.isLoading = false; // Set loading state to false when error is received
              });
            }
          }
      });
  </script>
</body>
</html>